---
title: 012 MySQL InnoDB 引擎中的聚簇索引和非聚簇索引有什么区别？
---

MySQL 的 InnoDB 存储引擎中， **聚簇索引（Clustered Index）**和**非聚簇索引（Secondary Index / Non-clustered Index）** 是两个非常重要的概念，它们在数据存储方式、访问效率、索引结构上有明显区别。下面我详细讲讲它们的区别和原理：

---

## 一、聚簇索引（Clustered Index）

### ✅ 定义：

在 **InnoDB** 中，**主键索引（Primary Key）就是聚簇索引**。所谓“聚簇”，是指**数据存储和索引是聚合在一起的**，也就是说：

> 聚簇索引的叶子节点**直接存储了完整的数据行**。

### ✅ 特点：

1. **数据和索引在一棵 B+ 树上**：

   * 索引的叶子节点就是数据本身。
   * 所以查找主键就等于查找数据，不需要“回表”。

2. **一张表只能有一个聚簇索引**：

   * 因为数据行只能按照一种顺序存储在磁盘上。

3. **默认情况下主键作为聚簇索引**，如果没有显式主键：

   * 优先选择第一个 `NOT NULL UNIQUE` 的列；
   * 再没有，InnoDB 会自动生成一个 6 字节的 `row_id` 作为主键。

### ✅ 示例结构：

假设有如下表：

```sql
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT
);
```

聚簇索引是一个 B+ 树结构，以 `id` 为键，叶子节点结构如下：

```
[id=1, name="Tom", age=20]
[id=2, name="Jerry", age=25]
```

---

## 二、非聚簇索引（Secondary Index）

### ✅ 定义：

InnoDB 中非聚簇索引是指：

> 叶子节点存储的不是完整的数据行，而是主键的值（row pointer）。

所以查询时，需要先通过二级索引定位到主键值，再通过主键回到聚簇索引中查数据，这个过程叫做 **回表**。

### ✅ 特点：

1. **叶子节点不存数据，存的是主键值（row ID）**；
2. **回表查询开销较大**；
3. **可以创建多个二级索引**；
4. **二级索引使用了主键作为 row pointer（不是物理地址）**，这就是所谓的 **逻辑指针**。

### ✅ 示例结构：

```sql
CREATE INDEX idx_name ON users(name);
```

`idx_name` 的叶子节点结构如下：

```
["Alice" => id=3]
["Bob"   => id=5]
```

查询：

```sql
SELECT age FROM users WHERE name = 'Bob';
```

过程是：

1. 在 `idx_name` 中定位 `name='Bob'`，找到主键 `id=5`；
2. 再到聚簇索引中通过 `id=5` 查到完整数据行（这一步就是**回表**）。

---

## 三、对比总结

| 项目      | 聚簇索引              | 非聚簇索引            |
| ------- | ----------------- | ---------------- |
| 存储结构    | 叶子节点存储整行数据        | 叶子节点存储主键值        |
| 数量限制    | 每个表只有一个           | 可以有多个            |
| 查询效率    | 查询主键效率高，无需回表      | 查询非主键字段可能需要回表    |
| 空间占用    | 比较紧凑              | 可能会造成更多磁盘读取      |
| 插入/更新效率 | 主键顺序插入效率高，更新主键代价大 | 二级索引维护成本低，但查询慢一些 |
| 主键变更    | 会导致聚簇索引结构变动       | 不会影响非聚簇索引结构      |

---

## 四、索引覆盖（覆盖索引优化）

如果查询只使用到了二级索引中包含的列，就可以**不回表**，这个优化叫做 **覆盖索引**：

```sql
SELECT name FROM users WHERE name = 'Bob';
```

如果 `name` 是二级索引，这条查询可以直接在索引中完成，不需要访问聚簇索引。

---

## 五、可视化类比图（简化）

```
聚簇索引：
[id=1, name, age]
[id=2, name, age]   ← 数据直接在这里

非聚簇索引：
[name="Tom" → id=1]
[name="Jerry" → id=2]
        ↓
再通过 id=2 去聚簇索引里查完整数据
```

---

继续提问：https://chatgpt.com/share/686d2cf3-7754-8010-b550-5f131c3d488e
