---
title: 055 	Spring 有哪几种事务传播行为?
---

Spring 中定义了 **7 种事务传播行为（Propagation）**，用于指定一个事务方法被另一个事务方法调用时，**事务应该如何传播（如何参与到已有事务中或创建新事务）**。

以下是每种传播行为的详解：

---

### ✅ 1. `REQUIRED`（默认值，支持当前事务，如果没有就新建一个）

* **行为说明**：如果当前存在事务，则加入该事务；如果没有事务，则新建一个。
* **使用场景**：绝大多数业务场景都适用，能确保方法在事务中执行。
* **举例**：

  * 方法 A 有事务，调用方法 B（`REQUIRED`），B 会加入 A 的事务。
  * 方法 A 没事务，调用方法 B（`REQUIRED`），B 会新建事务。

---

### ✅ 2. `REQUIRES_NEW`（挂起当前事务，创建新事务）

* **行为说明**：无论当前是否有事务，**都新建一个事务**。如果已有事务，**先挂起原事务**。
* **使用场景**：适用于需要 **独立提交或回滚** 的业务逻辑，比如写日志、记录操作记录等。
* **举例**：

  * 方法 A 有事务，调用方法 B（`REQUIRES_NEW`），B 会新建事务，A 的事务被挂起。B 提交或回滚，不影响 A。

---

### ✅ 3. `NESTED`（嵌套事务，依赖当前事务）

* **行为说明**：如果当前有事务，则在当前事务中嵌套一个子事务；如果没有事务，就像 `REQUIRED` 一样新建事务。
* **底层依赖**：需要底层数据库支持 **保存点（Savepoint）**。
* **使用场景**：在一个大事务中，某个子操作失败想 **局部回滚、不影响整体事务**。
* **举例**：

  * 方法 A 有事务，调用方法 B（`NESTED`），B 创建 Savepoint。若 B 回滚，只回滚自己的部分。

---

### ✅ 4. `SUPPORTS`（支持当前事务，如果没有就非事务执行）

* **行为说明**：如果当前有事务，就加入；如果没有，就以 **非事务方式执行**。
* **使用场景**：对事务不敏感的只读操作，如查询。
* **举例**：

  * 方法 A 有事务，调用方法 B（`SUPPORTS`），B 加入事务。
  * 方法 A 没事务，调用 B，B 就不启用事务。

---

### ✅ 5. `NOT_SUPPORTED`（不支持事务，挂起当前事务）

* **行为说明**：以 **非事务方式执行方法**，如果有事务，则先挂起当前事务。
* **使用场景**：调用的代码不需要事务，比如导出大数据、调用外部接口等。
* **举例**：

  * 方法 A 有事务，调用方法 B（`NOT_SUPPORTED`），A 的事务被挂起，B 无事务执行。

---

### ✅ 6. `MANDATORY`（必须在事务中运行）

* **行为说明**：如果当前有事务，就加入；否则抛出异常。
* **使用场景**：强依赖上层调用者开启事务的组件，如 DAO 层方法。
* **举例**：

  * 方法 A 没事务，调用 B（`MANDATORY`）→ 报错。
  * 方法 A 有事务，调用 B → 正常加入事务。

---

### ✅ 7. `NEVER`（不能在事务中运行）

* **行为说明**：如果当前有事务，抛出异常；否则正常执行（非事务）。
* **使用场景**：严格禁止事务的操作，如一些高性能的只读操作。
* **举例**：

  * 方法 A 有事务，调用 B（`NEVER`）→ 抛异常。
  * 方法 A 无事务，调用 B → 正常执行。

---

### ✅ 总结对比表：

| 传播行为            | 当前有事务      | 当前无事务 |
| --------------- | ---------- | ----- |
| `REQUIRED`      | 加入事务       | 新建事务  |
| `REQUIRES_NEW`  | 挂起原事务，建新事务 | 新建事务  |
| `NESTED`        | 创建嵌套事务     | 新建事务  |
| `SUPPORTS`      | 加入事务       | 非事务执行 |
| `NOT_SUPPORTED` | 挂起事务，非事务执行 | 非事务执行 |
| `MANDATORY`     | 加入事务       | 抛出异常  |
| `NEVER`         | 抛出异常       | 非事务执行 |

---

如果你想了解具体使用场景的最佳实践或在 Spring 中配置事务的方式（注解 / XML / AOP 等），我也可以进一步展开。

继续提问：https://chatgpt.com/share/68766907-c55c-8010-8ca1-dec42324591b
