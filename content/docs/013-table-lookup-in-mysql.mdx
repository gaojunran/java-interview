---
title: 013 MySQL 中的回表是什么？
---

在 MySQL 中，「**回表**」是一个关于 **使用二级索引（非聚簇索引）查询数据时访问主键索引** 的过程。这个概念只存在于 **InnoDB 存储引擎** 中，因为 InnoDB 使用的是 **聚簇索引（Clustered Index）**。

---

## 一、什么是回表？

回表指的是：

> 使用 **二级索引** 查找满足条件的记录主键值后，再通过 **主键** 去聚簇索引中获取 **完整的数据行** 的过程。

---

## 二、背景知识：InnoDB 的存储结构

### 1. 聚簇索引（主键索引）

* InnoDB 的表本身就是一棵 B+ 树，叶子节点存储了**完整的数据行**。
* 这棵树是按照**主键值排序**的。

### 2. 二级索引（辅助索引）

* 二级索引的叶子节点**只存储被索引的列值 + 主键值**，**不包含整行数据**。
* 所以，使用二级索引查到的数据**不是完整的行**。

---

## 三、为什么会发生回表？

因为**二级索引不包含完整的行数据**，当你查询的数据列**不完全在索引里**时：

1. MySQL 先在**二级索引**中查到符合条件的主键值。
2. 再用主键去**主键索引（聚簇索引）**中查到**完整的一行数据**。

这个查主键索引的过程就叫“**回表**”。

---

## 四、举个例子

假设有如下表结构：

```sql
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    email VARCHAR(100),
    INDEX idx_age(age)
);
```

### 查询1：需要回表

```sql
SELECT email FROM users WHERE age = 30;
```

* `WHERE age = 30` 可以用 `idx_age`（二级索引）过滤数据。
* 但 `email` 不在 `idx_age` 里，因此需要回表：

  * 从二级索引中找到 age = 30 对应的主键 id。
  * 再根据 id 回表查 `email`。

### 查询2：**不需要回表（覆盖索引）**

```sql
SELECT age FROM users WHERE age = 30;
```

* 查询的字段 `age` 就在 `idx_age` 里，不需要回表。
* 这种情况称为 **覆盖索引**。

---

## 五、回表的性能影响

* 回表意味着 **多一次随机 I/O**（读取主键索引）。
* 如果命中索引的结果较多，回表次数越多，性能越差。
* 所以高性能查询尽量使用**覆盖索引**，避免回表。

---

## 六、如何减少回表？

1. **覆盖索引**：让查询字段都包含在索引中。

   ```sql
   CREATE INDEX idx_age_email ON users(age, email);
   ```

2. **选择合适的主键**：主键越短，二级索引越小，回表效率越高。

3. **避免不必要的 SELECT \***：明确指定字段，方便用覆盖索引。

---

## 七、总结

| 特性     | 描述                  |
| ------ | ------------------- |
| 回表出现场景 | 二级索引无法提供完整数据时       |
| 本质     | 先用辅助索引查主键，再用主键查主键索引 |
| 是否慢？   | 比纯索引查询慢，多一次随机 I/O   |
| 如何避免？  | 使用覆盖索引，把查询字段放进索引    |

---

继续提问：https://chatgpt.com/share/686d2d8c-3380-8010-bc2d-320761b4effd
